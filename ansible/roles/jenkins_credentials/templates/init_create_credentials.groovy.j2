import jenkins.model.*
import com.cloudbees.plugins.credentials.*
import com.cloudbees.plugins.credentials.domains.*
import com.cloudbees.plugins.credentials.impl.*
import org.jenkinsci.plugins.plaincredentials.impl.*
import hudson.util.Secret

def store = Jenkins.instance.getExtensionList('com.cloudbees.plugins.credentials.SystemCredentialsProvider')[0].getStore()

// GitHub PAT
def githubId = 'github-pat'
if (!store.getCredentials(Domain.global()).any { it.id == githubId }) {
    def githubCred = new StringCredentialsImpl(
        CredentialsScope.GLOBAL,
        githubId,
        'GitHub Personal Access Token',
        Secret.fromString('{{ vault_github_pat }}')
    )
    store.addCredentials(Domain.global(), githubCred)
    println "âœ… Added GitHub PAT"
}

// DockerHub
def dockerId = 'dockerhub'
if (!store.getCredentials(Domain.global()).any { it.id == dockerId }) {
    def dockerCred = new UsernamePasswordCredentialsImpl(
        CredentialsScope.GLOBAL,
        dockerId,
        'DockerHub Credentials',
        '{{ vault_dockerhub_username }}',
        '{{ vault_dockerhub_password }}'
    )
    store.addCredentials(Domain.global(), dockerCred)
    println "âœ… Added DockerHub credentials"
}

// AWS
def awsId = 'aws-creds'
if (!store.getCredentials(Domain.global()).any { it.id == awsId }) {
    def awsCred = new UsernamePasswordCredentialsImpl(
        CredentialsScope.GLOBAL,
        awsId,
        'AWS Access Key and Secret',
        '{{ vault_aws_access_key }}',
        '{{ vault_aws_secret_key }}'
    )
    store.addCredentials(Domain.global(), awsCred)
    println "âœ… Added AWS credentials"
}

// .env (Secret Text)
def envId = 'aegonish-env'
if (!store.getCredentials(Domain.global()).any { it.id == envId }) {
    def envCred = new StringCredentialsImpl(
        CredentialsScope.GLOBAL,
        envId,
        '.env File Contents',
        Secret.fromString('''{{ vault_env_file | trim }}''')
    )
    store.addCredentials(Domain.global(), envCred)
    println "âœ… Added .env secret text"
}

println "ðŸŽ‰ All credentials are configured successfully!"
